pipeline {
    agent any
    environment {

        NEXUS_VERSION = "nexus3"

        NEXUS_PROTOCOL = "http"

        NEXUS_URL = "192.168.1.55:8081"

        NEXUS_REPOSITORY = "nexus-repo"

        NEXUS_CREDENTIAL_ID = "adminNexus"
        
        
        registry = "sarahch/springrepo"
        registryCredentials='dockerHub'
        dockerImage= ' '

      }
    stages{
    
    
        stage('stage1 : Checkout GIT'){
            steps {
                echo 'Pulling..';
                  git branch: 'sarahBranch',
                  url : 'https://github.com/hazem-soussi/projet_esprit.git';
            }
        }
           
    
    
       
        stage('stage6 : Create Package') {
            steps {
                echo "Creating Package"
                sh 'mvn package'
            }
        }
        
  
  

    
    
             stage("stage7: Build images") {
          steps {
              sh 'docker build -t sarah/springapp:$BUILD_NUMBER .'
              
             }
    
     }
     
     
     
     
      stage ("Push image to dockerHUb") {
        
            steps {
                script {
                    withCredentials([string(credentialsId: 'dockerhubpwdd', variable: 'dockerhubpwd')]) {
                        sh "docker login -u sarahch -p ${dockerhubpwd}"
                    sh 'docker push sarah/springapp:$BUILD_NUMBER'
                    }
          
                }
            
            }
        
    }
    
    
    
 
    
    }
}